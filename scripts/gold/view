SELECT prd_key, COUNT(*) FROM(
SELECT TOP (1000) [prd_id],
ROW_NUMBER() OVER(ORDER BY pn.prd_start_dt, pn.prd_key) AS product_key
      ,[cat_id]
      ,[prd_key]
      ,[prd_nm]
      ,[prd_cost]
      ,[prd_line]
      ,[prd_start_dt]
      ,[prd_end_dat]
      ,pc.cat
      ,pc.subcat,
      pc.maintance
  FROM [DataWarehouse].[silver].[crm_prd_info] pn
  LEFT JOIN silver.erp_px_cat_g1v2 pc
  ON pn.cat_id = pc.id
  WHERE prd_end_dat IS NULL --Filter out all historical data
  )t GROUP BY prd_key
  HAVING COUNT(*) > 1


  CREATE VIEW gold.dim_products AS
  SELECT TOP (1000) [prd_id],
ROW_NUMBER() OVER(ORDER BY pn.prd_start_dt, pn.prd_key) AS product_key
      ,[cat_id]
      ,[prd_key]
      ,[prd_nm]
      ,[prd_cost]
      ,[prd_line]
      ,[prd_start_dt]
      ,[prd_end_dat]
      ,pc.cat
      ,pc.subcat,
      pc.maintance
  FROM [DataWarehouse].[silver].[crm_prd_info] pn
  LEFT JOIN silver.erp_px_cat_g1v2 pc
  ON pn.cat_id = pc.id
  WHERE prd_end_dat IS NULL


  SELECT TOP (1000) 
       [sls_ord_num]
       ,pr.product_key
       ,cu.customer_key
      ,[sls_prd_key]
      ,[sls_cust_id]
      ,[sls_order_dt]
      ,[sls_ship_dt]
      ,[sls_due_dt]
      ,[sls_sales]
      ,[sls_quantity]
      ,[sls_price]
  FROM [DataWarehouse].[silver].[crm_sales_details] sd
  LEFT JOIN gold.dim_products pr
  ON sd.sls_prd_key = pr.prd_key
  LEFT JOIN gold.dim_customers cu
  ON sd.sls_cust_id = cu.customer_id


  -- Foregin key integritit (dimensions)
SELECT *
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON c.customer_key = f.customer_key
LEFT JOIN gold.dim_products p
ON p.product_key = f.product_key
WHERE c.customer_key IS NULL
